services:
  fcp-defra-id-stub:
    build:
      context: .
      target: development
    volumes:
      - ./src:/home/node/src
      - ./package.json:/home/node/package.json
    depends_on:
      localstack:
        condition: service_healthy

  localstack:
    image: localstack/localstack
    environment:
      LS_LOG: warn
      SERVICES: s3
      AWS_ACCESS_KEY_ID: test
      AWS_SECRET_ACCESS_KEY: test
    healthcheck:
      test: ['CMD', 'curl', 'localhost:4566']
      interval: 5s
      start_period: 5s
      retries: 3
